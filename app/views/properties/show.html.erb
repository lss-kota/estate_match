<!-- Estate Match Áâ©‰ª∂Ë©≥Á¥∞ÁîªÈù¢ -->
<div class="min-h-screen bg-gray-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8">
    
    <!-- „Éë„É≥„Åè„Åö„É™„Çπ„Éà -->
    <nav class="mb-4 sm:mb-8">
      <ol class="flex items-center space-x-1 sm:space-x-2 text-xs sm:text-sm text-gray-500 overflow-x-auto">
        <li class="flex-shrink-0"><%= link_to "„Éà„ÉÉ„Éó", root_path, class: "hover:text-estate-primary-600" %></li>
        <li class="flex-shrink-0"><span class="mx-1 sm:mx-2">/</span></li>
        <% if request.referer&.include?('/my_properties') || request.referer&.include?('/edit') || @came_from_edit %>
          <li class="flex-shrink-0"><%= link_to "Áâ©‰ª∂ÁÆ°ÁêÜ", my_properties_path, class: "hover:text-estate-primary-600" %></li>
        <% else %>
          <li class="flex-shrink-0"><%= link_to "Áâ©‰ª∂‰∏ÄË¶ß", properties_path, class: "hover:text-estate-primary-600" %></li>
        <% end %>
        <li class="flex-shrink-0"><span class="mx-1 sm:mx-2">/</span></li>
        <li class="text-gray-900 font-medium truncate"><%= @property.title %></li>
      </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-8">
      
      <!-- „É°„Ç§„É≥ÁîªÂÉè„ÉªË©≥Á¥∞ÊÉÖÂ†± -->
      <div class="lg:col-span-2">
        
        <!-- Áâ©‰ª∂ÁîªÂÉè -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden mb-4 sm:mb-6">
          <% if @property.images.attached? %>
            <div class="aspect-w-16 aspect-h-9">
              <%= image_tag @property.images.first, 
                    alt: @property.title,
                    class: "w-full h-48 sm:h-64 lg:h-96 object-cover" %>
            </div>
            <!-- „Çµ„É†„Éç„Ç§„É´ÁîªÂÉèÔºàË§áÊï∞ÁîªÂÉè„ÅÆÂ†¥ÂêàÔºâ -->
            <% if @property.images.count > 1 %>
              <div class="p-3 sm:p-4 border-t border-gray-200">
                <div class="grid grid-cols-4 sm:grid-cols-6 gap-2">
                  <% @property.images.each_with_index do |image, index| %>
                    <button class="aspect-w-1 aspect-h-1 rounded-md overflow-hidden hover:opacity-75 transition-opacity">
                      <%= image_tag image, 
                            alt: "#{@property.title} - ÁîªÂÉè#{index + 1}",
                            class: "w-full h-12 sm:h-16 object-cover" %>
                    </button>
                  <% end %>
                </div>
              </div>
            <% end %>
          <% else %>
            <!-- „Éá„Éï„Ç©„É´„ÉàÁîªÂÉè -->
            <div class="w-full h-48 sm:h-64 lg:h-96 bg-gradient-to-br from-estate-primary-100 to-estate-primary-200 flex items-center justify-center">
              <svg class="h-24 w-24 text-estate-primary-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M8 21l4-4 4 4" />
              </svg>
            </div>
          <% end %>
        </div>

        <!-- Áâ©‰ª∂Ë©≥Á¥∞ÊÉÖÂ†± -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">Áâ©‰ª∂Ë©≥Á¥∞</h2>
          
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <% if @property.property_type.present? %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Áâ©‰ª∂Á®ÆÂà•</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= Property.human_attribute_name("property_type.#{@property.property_type}") %></dd>
              </div>
            <% end %>
            
            <% if @property.building_area.present? %>
              <div>
                <dt class="text-sm font-medium text-gray-500">Âª∫Áâ©Èù¢Á©ç</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @property.building_area %>„é°</dd>
              </div>
            <% end %>
            
            <% if @property.land_area.present? %>
              <div>
                <dt class="text-sm font-medium text-gray-500">ÂúüÂú∞Èù¢Á©ç</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @property.land_area %>„é°</dd>
              </div>
            <% end %>
            
            <% if @property.rooms.present? %>
              <div>
                <dt class="text-sm font-medium text-gray-500">ÈñìÂèñ„Çä</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @property.rooms %></dd>
              </div>
            <% end %>
            
            <% if @property.construction_year.present? %>
              <div>
                <dt class="text-sm font-medium text-gray-500">ÁØâÂπ¥</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @property.construction_year %>Âπ¥</dd>
              </div>
            <% end %>
            
            <% if @property.parking.present? %>
              <div>
                <dt class="text-sm font-medium text-gray-500">ÈßêËªäÂ†¥</dt>
                <dd class="mt-1 text-sm text-gray-900"><%= @property.parking %></dd>
              </div>
            <% end %>
          </dl>
        </div>

        <!-- Áâ©‰ª∂Ë™¨Êòé -->
        <% if @property.description.present? %>
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mt-6">
            <h2 class="text-xl font-bold text-gray-900 mb-4">Áâ©‰ª∂„ÅÆÁâπÂæ¥„ÉªË©≥Á¥∞</h2>
            <div class="text-gray-700 whitespace-pre-line">
              <%= simple_format(@property.description) %>
            </div>
          </div>
        <% end %>

        <!-- ÈñìÂèñ„ÇäÂõ≥ -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mt-6">
          <h2 class="text-xl font-bold text-gray-900 mb-4">ÈñìÂèñ„ÇäÂõ≥</h2>
          
          <% if @property.floor_plan.attached? %>
            <!-- ÈñìÂèñ„ÇäÂõ≥„ÅåÂ≠òÂú®„Åô„ÇãÂ†¥Âêà -->
            <div class="flex justify-center" data-controller="floor-plan-modal">
              <div class="max-w-4xl w-full">
                <img src="<%= @property.floor_plan.url %>"
                     alt="<%= @property.title %> - ÈñìÂèñ„ÇäÂõ≥"
                     class="w-full h-auto rounded-lg border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200 cursor-pointer"
                     data-action="click->floor-plan-modal#open">
              </div>
            </div>
            <p class="text-sm text-gray-500 text-center mt-2">ÁîªÂÉè„Çí„ÇØ„É™„ÉÉ„ÇØ„Åô„Çã„Å®Êã°Â§ßË°®Á§∫„Åï„Çå„Åæ„Åô</p>
          <% else %>
            <!-- ÈñìÂèñ„ÇäÂõ≥„ÅåÂ≠òÂú®„Åó„Å™„ÅÑÂ†¥Âêà -->
            <div class="flex justify-center items-center py-16 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300">
              <div class="text-center">
                <svg class="mx-auto h-16 w-16 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
                </svg>
                <h3 class="mt-4 text-lg font-medium text-gray-900">ÈñìÂèñ„ÇäÂõ≥„Å™„Åó</h3>
                <p class="mt-2 text-sm text-gray-500">
                  „Åì„ÅÆÁâ©‰ª∂„Å´„ÅØÈñìÂèñ„ÇäÂõ≥„Åå<br>
                  ÁôªÈå≤„Åï„Çå„Å¶„ÅÑ„Åæ„Åõ„Çì
                </p>
                <% if user_signed_in? && @property.user == current_user %>
                  <div class="mt-4">
                    <%= link_to "ÈñìÂèñ„ÇäÂõ≥„ÇíËøΩÂä†", edit_property_path(@property), 
                          class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-estate-primary-600 bg-estate-primary-100 hover:bg-estate-primary-200 transition-colors duration-200" %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>

      <!-- „Çµ„Ç§„Éâ„Éê„ÉºÔºà‰æ°Ê†º„Éª„ÅäÂïè„ÅÑÂêà„Çè„ÅõÊÉÖÂ†±Ôºâ-->
      <div class="lg:col-span-1">
        
        <!-- ‰æ°Ê†º„Éª„ÅäÂïè„ÅÑÂêà„Çè„Åõ„Ç´„Éº„Éâ -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 sticky top-8">
          <!-- „Çø„Ç§„Éà„É´ -->
          <div class="mb-2">
            <h1 class="text-2xl font-bold text-gray-900"><%= @property.title %></h1>
          </div>
          
          <!-- „Çπ„ÉÜ„Éº„Çø„Çπ -->
          <div class="mb-4">
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">
              <%= Property.human_attribute_name("status.#{@property.status}") %>
            </span>
          </div>

          <!-- ‰æ°Ê†ºË°®Á§∫ -->
          <div class="mb-6">
            <% if @property.sale_price.present? && @property.rental_price.present? %>
              <!-- Â£≤Ë≤∑„ÉªË≥ÉË≤∏‰∏°Êñπ -->
              <div class="space-y-2">
                <div>
                  <span class="text-sm text-gray-500">Â£≤Âç¥‰æ°Ê†º</span>
                  <p class="text-2xl font-bold text-estate-primary-600">
                    <%= number_to_currency(@property.sale_price, unit: "", precision: 0, delimiter: ",") %>‰∏áÂÜÜ
                  </p>
                </div>
                <div>
                  <span class="text-sm text-gray-500">Ë≥ÉÊñô</span>
                  <p class="text-xl font-semibold text-estate-secondary-600">
                    <%= number_to_currency(@property.rental_price, unit: "", precision: 0, delimiter: ",") %>ÂÜÜ/Êúà
                  </p>
                </div>
              </div>
            <% elsif @property.sale_price.present? %>
              <!-- Â£≤Ë≤∑„ÅÆ„Åø -->
              <div>
                <span class="text-sm text-gray-500">Â£≤Âç¥‰æ°Ê†º</span>
                <p class="text-3xl font-bold text-estate-primary-600">
                  <%= number_to_currency(@property.sale_price, unit: "", precision: 0, delimiter: ",") %>‰∏áÂÜÜ
                </p>
              </div>
            <% elsif @property.rental_price.present? %>
              <!-- Ë≥ÉË≤∏„ÅÆ„Åø -->
              <div>
                <span class="text-sm text-gray-500">Ë≥ÉÊñô</span>
                <p class="text-3xl font-bold text-estate-secondary-600">
                  <%= number_to_currency(@property.rental_price, unit: "", precision: 0, delimiter: ",") %>ÂÜÜ/Êúà
                </p>
              </div>
            <% else %>
              <p class="text-xl text-gray-600">‰æ°Ê†ºÁõ∏Ë´á</p>
            <% end %>
          </div>

          <!-- ÊâÄÂú®Âú∞ -->
          <div class="mb-6">
            <h3 class="text-sm font-medium text-gray-500 mb-2">ÊâÄÂú®Âú∞</h3>
            <div class="text-gray-900">
              <p><%= [@property.prefecture, @property.city, @property.address].compact.join(' ') %></p>
            </div>
          </div>

          <!-- „Ç™„Éº„Éä„ÉºÊÉÖÂ†± -->
          <div class="mb-6 pb-6 border-b border-gray-200">
            <h3 class="text-sm font-medium text-gray-500 mb-2">ÊäïÁ®øËÄÖ</h3>
            <div class="flex items-center">
              <div class="h-10 w-10 bg-estate-primary-100 rounded-full flex items-center justify-center">
                <svg class="h-6 w-6 text-estate-primary-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
              </div>
              <div class="ml-3">
                <p class="text-sm font-medium text-gray-900">
                  <%= @property.user.email.split('@').first %>
                </p>
                <p class="text-xs text-gray-500">
                  <%= time_ago_in_words(@property.created_at) %>Ââç„Å´ÊäïÁ®ø
                </p>
              </div>
            </div>
          </div>

          <!-- „ÅäÂïè„ÅÑÂêà„Çè„Åõ„Éú„Çø„É≥ -->
          <div class="space-y-3">
            <% if user_signed_in? %>
              <% if current_user == @property.user %>
                <!-- Ëá™ÂàÜ„ÅÆÁâ©‰ª∂„ÅÆÂ†¥Âêà -->
                <div class="w-full bg-gray-100 text-gray-500 px-4 py-3 rounded-md font-medium text-center">
                  üí¨ Ëá™ÂàÜ„ÅÆÁâ©‰ª∂„Åß„Åô
                </div>
              <% else %>
                <%= form_with url: conversations_path, method: :post, local: true, class: "w-full" do |form| %>
                  <%= form.hidden_field :property_id, value: @property.id %>
                  <%= form.submit "üí¨ „ÅäÂïè„ÅÑÂêà„Çè„Åõ„Åô„Çã", 
                      class: "w-full bg-estate-primary-600 text-white px-4 py-3 rounded-md font-medium hover:bg-estate-primary-700 transition-colors duration-200 cursor-pointer" %>
                <% end %>
              <% end %>
            <% else %>
              <%= link_to "„É≠„Ç∞„Ç§„É≥„Åó„Å¶„ÅäÂïè„ÅÑÂêà„Çè„Åõ", new_user_session_path,
                    class: "block w-full text-center bg-estate-primary-600 text-white px-4 py-3 rounded-md font-medium hover:bg-estate-primary-700 transition-colors duration-200" %>
            <% end %>
            
            <!-- „ÅäÊ∞ó„Å´ÂÖ•„Çä„Éú„Çø„É≥ÔºàË≥ºÂÖ•Â∏åÊúõËÄÖ„ÅÆ„ÅøÔºâ -->
            <% if user_signed_in? && current_user.buyer? %>
              <button type="button" 
                      class="w-full px-4 py-3 rounded-md font-medium transition-colors duration-200 border <%= @property.favorited_by?(current_user) ? 'bg-pink-50 border-pink-200 text-pink-700' : 'bg-gray-50 border-gray-200 text-gray-700 hover:bg-pink-50 hover:border-pink-200 hover:text-pink-700' %>"
                      data-controller="favorite"
                      data-favorite-property-id-value="<%= @property.id %>"
                      data-favorite-favorited-value="<%= @property.favorited_by?(current_user) %>"
                      data-action="click->favorite#toggle">
                <div class="flex items-center justify-center space-x-2">
                  <svg class="w-5 h-5" fill="<%= @property.favorited_by?(current_user) ? 'currentColor' : 'none' %>" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                  <span class="favorite-text">
                    <%= @property.favorited_by?(current_user) ? '„ÅäÊ∞ó„Å´ÂÖ•„ÇäÊ∏à' : '„ÅäÊ∞ó„Å´ÂÖ•„Çä„Å´ËøΩÂä†„Åô„Çã' %>
                  </span>
                </div>
              </button>
            <% end %>
          </div>

          <!-- „Çø„Ç∞Ë°®Á§∫ -->
          <% if @property.tags.any? %>
            <div class="mt-6 pt-6 border-t border-gray-200">
              <h3 class="text-sm font-medium text-gray-500 mb-3">„Çø„Ç∞</h3>
              <div class="flex flex-wrap gap-2">
                <% @property.tags.each do |tag| %>
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    <%= tag.name %>
                  </span>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <!-- Èñ¢ÈÄ£Áâ©‰ª∂ -->
    <div class="mt-12">
      <h2 class="text-2xl font-bold text-gray-900 mb-6">„Åì„ÅÆÂú∞Âüü„ÅÆ‰ªñ„ÅÆÁâ©‰ª∂</h2>
      <!-- TODO: Èñ¢ÈÄ£Áâ©‰ª∂„ÅÆË°®Á§∫ -->
      <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-8 text-center">
        <p class="text-gray-500">Èñ¢ÈÄ£Áâ©‰ª∂Ê©üËÉΩ„ÅØ‰ªäÂæåÂÆüË£Ö‰∫àÂÆö„Åß„Åô</p>
      </div>
    </div>
  </div>

  <!-- ÈñìÂèñ„ÇäÂõ≥Êã°Â§ß„É¢„Éº„ÉÄ„É´ -->
  <% if @property.floor_plan.attached? %>
    <div id="floor-plan-modal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center p-4" data-controller="floor-plan-modal">
      <div class="relative max-w-4xl max-h-full">
        <!-- Èñâ„Åò„Çã„Éú„Çø„É≥ -->
        <button type="button" 
                class="absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors duration-200"
                data-action="click->floor-plan-modal#close">
          <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
        
        <!-- ÈñìÂèñ„ÇäÂõ≥ÁîªÂÉè -->
        <div class="bg-white rounded-lg p-4">
          <img src="<%= @property.floor_plan.url %>"
               alt="<%= @property.title %> - ÈñìÂèñ„ÇäÂõ≥ÔºàÊã°Â§ßÔºâ"
               class="max-w-full max-h-[80vh] object-contain">
        </div>
      </div>
      
      <!-- ËÉåÊôØ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã -->
      <div class="absolute inset-0" data-action="click->floor-plan-modal#close"></div>
    </div>
  <% end %>
</div>
