<!-- Estate Match Áâ©‰ª∂‰∏ÄË¶ßÁîªÈù¢ -->
<div class="min-h-screen bg-gray-50">
  <!-- „Éò„ÉÉ„ÉÄ„Éº -->
  <div class="bg-white shadow-sm">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-3xl font-bold text-gray-900">Áâ©‰ª∂„ÇíÊé¢„Åô</h1>
          <p class="text-gray-600 mt-1">„ÅÇ„Å™„Åü„ÅÆÁêÜÊÉ≥„ÅÆÁâ©‰ª∂„ÇíË¶ã„Å§„Åë„Åæ„Åó„Çá„ÅÜ</p>
        </div>
        <div class="text-sm text-gray-500">
          <span class="font-medium text-estate-primary-600"><%= @properties.count %></span>‰ª∂„ÅÆÁâ©‰ª∂
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
      
      <!-- Ê§úÁ¥¢„Éª„Éï„Ç£„É´„Çø„Çµ„Ç§„Éâ„Éê„Éº -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden sticky top-8" 
             data-controller="toggle">
          
          <!-- Ê§úÁ¥¢Êù°‰ª∂„Éò„ÉÉ„ÉÄ„ÉºÔºàÂ∏∏„Å´Ë°®Á§∫Ôºâ -->
          <div class="p-4 border-b border-gray-200">
            <button type="button" 
                    data-action="click->toggle#toggle"
                    class="w-full flex items-center justify-between text-left">
              <h3 class="text-lg font-semibold text-gray-900 flex items-center">
                üîç Ê§úÁ¥¢Êù°‰ª∂
              </h3>
              <svg data-toggle-target="icon" 
                   class="h-4 w-4 text-gray-500 transform transition-transform duration-200" 
                   fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
              </svg>
            </button>
          </div>

          <!-- Ê§úÁ¥¢Êù°‰ª∂„Éï„Ç©„Éº„É†ÔºàÊäò„Çä„Åü„Åü„ÅøÂèØËÉΩÔºâ -->
          <div data-toggle-target="content" class="hidden">
            <div class="p-6">
              <%= form_with url: properties_path, method: :get, local: true, 
                            data: { controller: "property-search" } do |form| %>
              
                <!-- „Ç≠„Éº„ÉØ„Éº„ÉâÊ§úÁ¥¢ -->
                <div class="mb-4">
                  <%= form.label :search, "„Ç≠„Éº„ÉØ„Éº„Éâ", class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= form.text_field :search, 
                        value: params[:search],
                        placeholder: "Áâ©‰ª∂Âêç„Éª‰ΩèÊâÄ„ÅßÊ§úÁ¥¢",
                        class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-estate-primary-500 focus:border-transparent" %>
                </div>

                <!-- ÂèñÂºïÁ®ÆÂà• -->
                <div class="mb-4">
                  <%= form.label :transaction_type, "ÂèñÂºïÁ®ÆÂà•", class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= form.select :transaction_type, 
                        options_for_select([
                          ["„Åô„Åπ„Å¶", ""],
                          ["Â£≤Ë≤∑", "sale"],
                          ["Ë≥ÉË≤∏", "rent"],
                          ["Â£≤Ë≤∑„ÉªË≥ÉË≤∏‰∏°Êñπ", "both"]
                        ], params[:transaction_type]),
                        {}, 
                        { class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-estate-primary-500" } %>
                </div>

                <!-- Áâ©‰ª∂Á®ÆÂà• -->
                <div class="mb-4">
                  <%= form.label :property_type, "Áâ©‰ª∂Á®ÆÂà•", class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= form.select :property_type,
                        options_for_select([
                          ["„Åô„Åπ„Å¶", ""],
                          ["Êà∏Âª∫„Å¶", "house"],
                          ["„Éû„É≥„Ç∑„Éß„É≥", "mansion"],
                          ["ÂúüÂú∞", "land"],
                          ["„Ç¢„Éë„Éº„Éà", "apartment"]
                        ], params[:property_type]),
                        {},
                        { class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-estate-primary-500" } %>
                </div>

                <!-- ‰æ°Ê†ºÂ∏Ø -->
                <div class="mb-4">
                  <label class="block text-sm font-medium text-gray-700 mb-2">‰æ°Ê†ºÂ∏Ø</label>
                  <div class="grid grid-cols-2 gap-2">
                    <%= form.number_field :min_price,
                          value: params[:min_price],
                          placeholder: "ÊúÄ‰Ωé‰æ°Ê†º",
                          class: "px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-estate-primary-500" %>
                    <%= form.number_field :max_price,
                          value: params[:max_price],
                          placeholder: "ÊúÄÈ´ò‰æ°Ê†º",
                          class: "px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-estate-primary-500" %>
                  </div>
                </div>

                <!-- ÈÉΩÈÅìÂ∫úÁúå -->
                <div class="mb-4">
                  <%= form.label :prefecture, "ÈÉΩÈÅìÂ∫úÁúå", class: "block text-sm font-medium text-gray-700 mb-2" %>
                  <%= form.select :prefecture,
                        options_for_select([
                          ["„Åô„Åπ„Å¶", ""],
                          ["ÂåóÊµ∑ÈÅì", "ÂåóÊµ∑ÈÅì"], ["ÈùíÊ£ÆÁúå", "ÈùíÊ£ÆÁúå"], ["Â≤©ÊâãÁúå", "Â≤©ÊâãÁúå"], ["ÂÆÆÂüéÁúå", "ÂÆÆÂüéÁúå"], ["ÁßãÁî∞Áúå", "ÁßãÁî∞Áúå"], 
                          ["Â±±ÂΩ¢Áúå", "Â±±ÂΩ¢Áúå"], ["Á¶èÂ≥∂Áúå", "Á¶èÂ≥∂Áúå"], ["Ëå®ÂüéÁúå", "Ëå®ÂüéÁúå"], ["Ê†ÉÊú®Áúå", "Ê†ÉÊú®Áúå"], ["Áæ§È¶¨Áúå", "Áæ§È¶¨Áúå"],
                          ["ÂüºÁéâÁúå", "ÂüºÁéâÁúå"], ["ÂçÉËëâÁúå", "ÂçÉËëâÁúå"], ["Êù±‰∫¨ÈÉΩ", "Êù±‰∫¨ÈÉΩ"], ["Á•ûÂ•àÂ∑ùÁúå", "Á•ûÂ•àÂ∑ùÁúå"], ["Êñ∞ÊΩüÁúå", "Êñ∞ÊΩüÁúå"],
                          ["ÂØåÂ±±Áúå", "ÂØåÂ±±Áúå"], ["Áü≥Â∑ùÁúå", "Áü≥Â∑ùÁúå"], ["Á¶è‰∫ïÁúå", "Á¶è‰∫ïÁúå"], ["Â±±Ê¢®Áúå", "Â±±Ê¢®Áúå"], ["Èï∑ÈáéÁúå", "Èï∑ÈáéÁúå"],
                          ["Â≤êÈòúÁúå", "Â≤êÈòúÁúå"], ["ÈùôÂ≤°Áúå", "ÈùôÂ≤°Áúå"], ["ÊÑõÁü•Áúå", "ÊÑõÁü•Áúå"], ["‰∏âÈáçÁúå", "‰∏âÈáçÁúå"], ["ÊªãË≥ÄÁúå", "ÊªãË≥ÄÁúå"],
                          ["‰∫¨ÈÉΩÂ∫ú", "‰∫¨ÈÉΩÂ∫ú"], ["Â§ßÈò™Â∫ú", "Â§ßÈò™Â∫ú"], ["ÂÖµÂ∫´Áúå", "ÂÖµÂ∫´Áúå"], ["Â•àËâØÁúå", "Â•àËâØÁúå"], ["ÂíåÊ≠åÂ±±Áúå", "ÂíåÊ≠åÂ±±Áúå"],
                          ["È≥•ÂèñÁúå", "È≥•ÂèñÁúå"], ["Â≥∂Ê†πÁúå", "Â≥∂Ê†πÁúå"], ["Â≤°Â±±Áúå", "Â≤°Â±±Áúå"], ["Â∫ÉÂ≥∂Áúå", "Â∫ÉÂ≥∂Áúå"], ["Â±±Âè£Áúå", "Â±±Âè£Áúå"],
                          ["Âæ≥Â≥∂Áúå", "Âæ≥Â≥∂Áúå"], ["È¶ôÂ∑ùÁúå", "È¶ôÂ∑ùÁúå"], ["ÊÑõÂ™õÁúå", "ÊÑõÂ™õÁúå"], ["È´òÁü•Áúå", "È´òÁü•Áúå"], ["Á¶èÂ≤°Áúå", "Á¶èÂ≤°Áúå"],
                          ["‰ΩêË≥ÄÁúå", "‰ΩêË≥ÄÁúå"], ["Èï∑Â¥éÁúå", "Èï∑Â¥éÁúå"], ["ÁÜäÊú¨Áúå", "ÁÜäÊú¨Áúå"], ["Â§ßÂàÜÁúå", "Â§ßÂàÜÁúå"], ["ÂÆÆÂ¥éÁúå", "ÂÆÆÂ¥éÁúå"],
                          ["ÈπøÂÖêÂ≥∂Áúå", "ÈπøÂÖêÂ≥∂Áúå"], ["Ê≤ñÁ∏ÑÁúå", "Ê≤ñÁ∏ÑÁúå"]
                        ], params[:prefecture]),
                        {},
                        { class: "w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-estate-primary-500" } %>
                </div>

                <!-- Ê§úÁ¥¢„Éú„Çø„É≥ -->
                <div class="mb-4">
                  <%= form.submit "Ê§úÁ¥¢„Åô„Çã", 
                        class: "w-full bg-estate-primary-600 text-white px-4 py-3 rounded-md font-medium hover:bg-estate-primary-700 transition-colors duration-200" %>
                </div>

                <!-- „É™„Çª„ÉÉ„Éà„Éú„Çø„É≥ -->
                <div>
                  <%= link_to "Êù°‰ª∂„Çí„ÇØ„É™„Ç¢", properties_path, 
                        class: "block w-full text-center bg-gray-100 text-gray-700 px-4 py-2 rounded-md font-medium hover:bg-gray-200 transition-colors duration-200" %>
                </div>

              <% end %>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Áâ©‰ª∂‰∏ÄË¶ß„É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
      <div class="lg:col-span-3">
        
        <!-- „ÇΩ„Éº„Éà„ÉªË°®Á§∫„Ç™„Éó„Ç∑„Éß„É≥ -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4 mb-6">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
            <div class="flex flex-wrap gap-2">
              <!-- ÁèæÂú®„ÅÆÊ§úÁ¥¢Êù°‰ª∂Ë°®Á§∫ -->
              <% if params[:search].present? %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-estate-primary-100 text-estate-primary-800">
                  „Ç≠„Éº„ÉØ„Éº„Éâ: <%= params[:search] %>
                </span>
              <% end %>
              <% if params[:property_type].present? %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-estate-secondary-100 text-estate-secondary-800">
                  <%= Property.human_attribute_name("property_type.#{params[:property_type]}") %>
                </span>
              <% end %>
              <% if params[:prefecture].present? %>
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-green-100 text-green-800">
                  <%= params[:prefecture] %>
                </span>
              <% end %>
            </div>

            <!-- „ÇΩ„Éº„Éà„Ç™„Éó„Ç∑„Éß„É≥ -->
            <div class="flex items-center gap-2">
              <%= form_with url: properties_path, method: :get, local: true, class: "flex items-center gap-2" do |form| %>
                <!-- Êó¢Â≠ò„ÅÆÊ§úÁ¥¢„Éë„É©„É°„Éº„Çø„Çí‰øùÊåÅ -->
                <%= form.hidden_field :search, value: params[:search] %>
                <%= form.hidden_field :property_type, value: params[:property_type] %>
                <%= form.hidden_field :prefecture, value: params[:prefecture] %>
                <%= form.hidden_field :transaction_type, value: params[:transaction_type] %>
                <%= form.hidden_field :min_price, value: params[:min_price] %>
                <%= form.hidden_field :max_price, value: params[:max_price] %>
                
                <label class="text-sm text-gray-600">‰∏¶„Å≥È†Ü:</label>
                <%= form.select :sort,
                      options_for_select([
                        ["Êñ∞ÁùÄÈ†Ü", "created_at_desc"],
                        ["‰æ°Ê†º„ÅÆÂÆâ„ÅÑÈ†Ü", "price_asc"],
                        ["‰æ°Ê†º„ÅÆÈ´ò„ÅÑÈ†Ü", "price_desc"],
                        ["Êõ¥Êñ∞Êó•È†Ü", "updated_at_desc"]
                      ], params[:sort] || "created_at_desc"),
                      {},
                      { 
                        class: "text-sm border border-gray-300 rounded px-3 py-1 focus:outline-none focus:ring-2 focus:ring-estate-primary-500",
                        onchange: "this.form.submit();"
                      } %>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Áâ©‰ª∂„Ç´„Éº„Éâ‰∏ÄË¶ß -->
        <% if @properties.any? %>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <% @properties.each do |property| %>
              <%= render 'property_card', property: property %>
            <% end %>
          </div>

          <!-- „Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥ -->
          <div class="flex justify-center">
            <p class="text-gray-500 text-sm">‚Äª„Éö„Éº„Ç∏„Éç„Éº„Ç∑„Éß„É≥Ê©üËÉΩ„ÅØ‰ªäÂæåÂÆüË£Ö‰∫àÂÆö„Åß„Åô</p>
          </div>
          
        <% else %>
          <!-- ÁµêÊûú„Åå0‰ª∂„ÅÆÂ†¥Âêà -->
          <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-12 text-center">
            <div class="mb-4">
              <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z" />
              </svg>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Ë©≤ÂΩì„Åô„ÇãÁâ©‰ª∂„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì</h3>
            <p class="text-gray-600 mb-4">Ê§úÁ¥¢Êù°‰ª∂„ÇíÂ§âÊõ¥„Åó„Å¶„ÅäË©¶„Åó„Åè„Å†„Åï„ÅÑ</p>
            <%= link_to "ÂÖ®„Å¶„ÅÆÁâ©‰ª∂„ÇíË¶ã„Çã", properties_path, 
                  class: "inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-estate-primary-600 hover:bg-estate-primary-700" %>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
