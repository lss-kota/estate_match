<div class="min-h-screen bg-estate-warm-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
  <div class="max-w-md w-full space-y-8">
    <div>
      <div class="text-center">
        <%= link_to root_path, class: "inline-block" do %>
          <h1 class="text-3xl font-bold text-estate-primary-600 mb-2">Estate Match</h1>
        <% end %>
        <h2 class="text-2xl font-bold text-estate-dark-800">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</h2>
        <p class="mt-2 text-estate-dark-500">ç†æƒ³ã®ä¸å‹•ç”£å–å¼•ã‚’å§‹ã‚ã¾ã—ã‚‡ã†</p>
      </div>
    </div>
    
    <div class="bg-white rounded-2xl shadow-lg p-8">
      <%= form_for(resource, as: resource_name, url: registration_path(resource_name), local: true, class: "space-y-6") do |f| %>
        <%= render "devise/shared/error_messages", resource: resource %>

        <!-- Name Field -->
        <div>
          <%= f.label :name, "ãŠåå‰", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
          <%= f.text_field :name, 
                           autofocus: true,
                           class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 placeholder-estate-dark-300 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 focus:z-10",
                           placeholder: "ç”°ä¸­å¤ªéƒ" %>
        </div>

        <!-- User Type Field -->
        <div>
          <%= f.label :user_type, "åˆ©ç”¨ç›®çš„", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
          <%= f.select :user_type, 
                       options_for_select([
                         ['ç‰©ä»¶ã‚’æ¢ã—ãŸã„ï¼ˆè³¼å…¥å¸Œæœ›è€…ï¼‰', 'buyer'],
                         ['ç‰©ä»¶ã‚’ç™»éŒ²ã—ãŸã„ï¼ˆã‚ªãƒ¼ãƒŠãƒ¼ï¼‰', 'owner'],
                         ['ä¸å‹•ç”£æ¥­è€…ã¨ã—ã¦ç™»éŒ²', 'agent']
                       ], 'buyer'),
                       {},
                       { class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 bg-white" } %>
        </div>

        <!-- Agent-specific Fields (hidden by default) -->
        <div id="agent-fields" class="space-y-4" style="display: none;">
          <!-- Company Name Field -->
          <div>
            <%= f.label :company_name, "ä¼šç¤¾å", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
            <%= f.text_field :company_name, 
                             id: "agent_company_name",
                             class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 placeholder-estate-dark-300 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 focus:z-10",
                             placeholder: "æ ªå¼ä¼šç¤¾â—¯â—¯ä¸å‹•ç”£" %>
          </div>

          <!-- License Number Field -->
          <div>
            <%= f.label :license_number, "å®…åœ°å»ºç‰©å–å¼•æ¥­å…è¨±ç•ªå·", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
            <%= f.text_field :license_number, 
                             id: "agent_license_number",
                             class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 placeholder-estate-dark-300 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 focus:z-10",
                             placeholder: "æ±äº¬éƒ½çŸ¥äº‹(1)ç¬¬12345å·" %>
            <p class="text-xs text-estate-dark-500 mt-1">å®…åœ°å»ºç‰©å–å¼•æ¥­ã®å…è¨±ç•ªå·ã‚’æ­£ç¢ºã«å…¥åŠ›ã—ã¦ãã ã•ã„</p>
          </div>

          <!-- Membership Plan Selection -->
          <div>
            <%= f.label :membership_plan_id, "ä¼šå“¡ãƒ—ãƒ©ãƒ³", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
            <%= f.select :membership_plan_id,
                         options_from_collection_for_select(MembershipPlan.active.ordered, :id, :name),
                         { prompt: 'ãƒ—ãƒ©ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„' },
                         { id: "agent_membership_plan", class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 bg-white" } %>
            <p class="text-xs text-estate-dark-500 mt-1">å¾Œã‹ã‚‰å¤‰æ›´ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™</p>
          </div>

          <!-- Membership Plans Information -->
          <div class="bg-estate-warm-50 rounded-lg p-4">
            <h4 class="font-medium text-estate-dark-800 mb-2">ğŸ’¡ ä¼šå“¡ãƒ—ãƒ©ãƒ³æ¯”è¼ƒ</h4>
            <div class="space-y-2 text-sm text-estate-dark-600">
              <% MembershipPlan.active.ordered.each do |plan| %>
                <div class="flex justify-between items-center">
                  <span class="font-medium"><%= plan.name %></span>
                  <div class="text-right">
                    <span class="text-estate-primary-600 font-bold"><%= plan.formatted_price %></span>
                    <span class="text-xs block">æœˆ<%= plan.monthly_property_limit %>ç‰©ä»¶ã¾ã§</span>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>

        <!-- Email Field -->
        <div>
          <%= f.label :email, "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
          <%= f.email_field :email, 
                            autocomplete: "email",
                            class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 placeholder-estate-dark-300 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 focus:z-10",
                            placeholder: "example@email.com" %>
        </div>

        <!-- Password Field -->
        <div>
          <%= f.label :password, "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
          <% if @minimum_password_length %>
            <p class="text-xs text-estate-dark-500 mb-1">ï¼ˆ<%= @minimum_password_length %>æ–‡å­—ä»¥ä¸Šï¼‰</p>
          <% end %>
          <%= f.password_field :password, 
                               autocomplete: "new-password",
                               class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 placeholder-estate-dark-300 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 focus:z-10",
                               placeholder: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" %>
        </div>

        <!-- Password Confirmation Field -->
        <div>
          <%= f.label :password_confirmation, "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰", class: "block text-sm font-medium text-estate-dark-700 mb-2" %>
          <%= f.password_field :password_confirmation, 
                               autocomplete: "new-password",
                               class: "appearance-none rounded-lg relative block w-full px-3 py-3 border border-estate-warm-400 placeholder-estate-dark-300 text-estate-dark-900 focus:outline-none focus:ring-estate-primary-500 focus:border-estate-primary-500 focus:z-10",
                               placeholder: "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å†å…¥åŠ›" %>
        </div>

        <!-- Submit Button -->
        <div class="pt-8">
          <button type="submit" class="w-full bg-estate-primary-600 hover:bg-estate-primary-700 text-white font-bold py-4 px-6 rounded-lg text-lg transition duration-300 shadow-md">
            ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ
          </button>
        </div>
      <% end %>

      <!-- Links -->
      <div class="text-center pt-4">
        <p class="text-estate-dark-500 text-sm">
          æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯
          <%= link_to "ãƒ­ã‚°ã‚¤ãƒ³", new_user_session_path, class: "text-estate-primary-600 hover:text-estate-primary-500 font-medium" %>
        </p>
      </div>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const userTypeSelect = document.querySelector('select[name="user[user_type]"]');
  const agentFields = document.getElementById('agent-fields');
  
  function toggleAgentFields() {
    const companyNameField = document.getElementById('agent_company_name');
    const licenseNumberField = document.getElementById('agent_license_number');
    const membershipPlanField = document.getElementById('agent_membership_plan');
    
    if (userTypeSelect.value === 'agent') {
      console.log('Showing agent fields'); // Debug
      agentFields.style.display = 'block';
      agentFields.style.opacity = '0';
      agentFields.style.transform = 'translateY(-10px)';
      
      // Set required attributes
      if (companyNameField) companyNameField.required = true;
      if (licenseNumberField) licenseNumberField.required = true;
      if (membershipPlanField) membershipPlanField.required = true;
      
      // Smooth animation
      setTimeout(() => {
        agentFields.style.transition = 'all 0.3s ease-in-out';
        agentFields.style.opacity = '1';
        agentFields.style.transform = 'translateY(0)';
      }, 10);
    } else {
      console.log('Hiding agent fields'); // Debug
      agentFields.style.transition = 'all 0.3s ease-in-out';
      agentFields.style.opacity = '0';
      agentFields.style.transform = 'translateY(-10px)';
      
      // Remove required attributes
      if (companyNameField) companyNameField.required = false;
      if (licenseNumberField) licenseNumberField.required = false;
      if (membershipPlanField) membershipPlanField.required = false;
      
      setTimeout(() => {
        if (userTypeSelect.value !== 'agent') {
          agentFields.style.display = 'none';
        }
      }, 300);
    }
  }
  
  // Initial check
  toggleAgentFields();
  
  // Listen for changes
  userTypeSelect.addEventListener('change', toggleAgentFields);
  
  // Debug form submission
  const form = document.querySelector('form');
  if (form) {
    form.addEventListener('submit', function(e) {
      if (userTypeSelect.value === 'agent') {
        const companyName = document.getElementById('agent_company_name').value;
        const licenseNumber = document.getElementById('agent_license_number').value;
        const membershipPlan = document.getElementById('agent_membership_plan').value;
        
        console.log('Submitting agent form with:', {
          company_name: companyName,
          license_number: licenseNumber,
          membership_plan_id: membershipPlan
        });
        
        if (!companyName || !licenseNumber || !membershipPlan) {
          console.warn('Required agent fields are missing!');
        }
      }
    });
  }
});
</script>
