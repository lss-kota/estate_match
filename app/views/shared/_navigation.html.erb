<nav class="bg-white shadow-sm border-b border-estate-warm-200" data-controller="toggle">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- ロゴ・ブランド -->
      <div class="flex items-center">
        <%= link_to root_path, class: "flex items-center" do %>
          <h1 class="text-xl sm:text-2xl font-bold text-estate-primary-600">Estate Match</h1>
        <% end %>
      </div>

      <!-- モバイルメニューボタン -->
      <div class="md:hidden">
        <button type="button" class="text-estate-dark-600 hover:text-estate-primary-600 focus:outline-none focus:text-estate-primary-600" data-action="click->toggle#toggle">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>

      <!-- デスクトップナビゲーションメニュー -->
      <div class="hidden md:flex items-center space-x-4 lg:space-x-6">
        <% if user_signed_in? %>
          <!-- ログイン済みの場合 -->
          <div class="flex items-center space-x-2 lg:space-x-4">
            <!-- 物件一覧へのリンク -->
            <%= link_to "物件を探す", properties_path, 
                  class: "text-sm lg:text-base text-estate-dark-600 hover:text-estate-primary-600 font-medium transition-colors duration-200" %>
            
            <!-- お気に入りへのリンク（購買者のみ） -->
            <% if current_user.buyer? %>
              <%= link_to "お気に入り", favorites_path, 
                    class: "text-sm lg:text-base text-estate-dark-600 hover:text-estate-success-600 font-medium transition-colors duration-200" %>
            <% end %>
            
            <!-- オーナー向け：マイ物件 -->
            <% if current_user.owner? %>
              <%= link_to "物件管理", my_properties_path, 
                    class: "text-sm lg:text-base text-estate-dark-600 hover:text-estate-primary-600 font-medium transition-colors duration-200" %>
            <% end %>
            
            <!-- 不動産業者向けメニュー -->
            <% if current_user.agent? %>
              <%= link_to "オーナー検索", properties_path, 
                    class: "text-sm lg:text-base text-estate-dark-600 hover:text-estate-primary-600 font-medium transition-colors duration-200" %>
              <%= link_to "パートナー管理", partnerships_path, 
                    class: "text-sm lg:text-base text-estate-dark-600 hover:text-estate-success-600 font-medium transition-colors duration-200" %>
              <div class="relative">
                <%= link_to conversations_path, 
                      class: "text-sm lg:text-base text-estate-dark-600 hover:text-estate-primary-600 font-medium transition-colors duration-200 flex items-center" do %>
                  メッセージ
                  <% if current_user.unread_messages_count > 0 %>
                    <span class="ml-1 bg-red-500 text-white text-xs rounded-full px-2 py-0.5">
                      <%= current_user.unread_messages_count %>
                    </span>
                  <% end %>
                <% end %>
              </div>
            <% end %>
            
            <!-- マイページ・ログアウト -->
            <div class="flex items-center space-x-2">
              <%= link_to "マイページ", dashboard_path, 
                    class: "bg-estate-primary-100 text-estate-primary-700 hover:bg-estate-primary-200 font-medium px-3 py-2 rounded-md transition-colors duration-200 text-sm" %>
              
              <%= button_to "ログアウト", destroy_user_session_path, 
                            method: :delete,
                            form: { "data-turbo-confirm": "ログアウトしますか？" },
                            class: "bg-estate-primary-600 hover:bg-estate-primary-700 text-white font-medium px-3 py-2 rounded-md transition-colors duration-200 text-sm" %>
            </div>
          </div>
        <% else %>
          <!-- ログインしていない場合 -->
          <div class="flex items-center space-x-2 lg:space-x-4">
            <%= link_to "物件を探す", properties_path, 
                  class: "text-sm lg:text-base text-estate-dark-600 hover:text-estate-primary-600 font-medium transition-colors duration-200" %>
            <%= link_to "ログイン", new_user_session_path, 
                  class: "bg-estate-primary-600 hover:bg-estate-primary-700 text-white font-medium px-3 py-2 rounded-md transition-colors duration-200 text-sm" %>
            <%= link_to "会員登録", new_user_registration_path, 
                  class: "border border-estate-primary-600 text-estate-primary-600 hover:bg-estate-primary-600 hover:text-white font-medium px-3 py-2 rounded-md transition-colors duration-200 text-sm" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- モバイルメニュー -->
    <div class="md:hidden hidden" data-toggle-target="content">
      <div class="px-2 pt-2 pb-3 space-y-1 bg-white border-t border-estate-warm-200">
        <% if user_signed_in? %>
          <!-- ログイン済みの場合 -->
          <%= link_to "マイページ", dashboard_path, 
                class: "block px-3 py-2 rounded-md text-base font-medium text-estate-primary-700 bg-estate-primary-50" %>
          
          <%= link_to "物件を探す", properties_path, 
                class: "block px-3 py-2 rounded-md text-base font-medium text-estate-dark-600 hover:text-estate-primary-600 hover:bg-estate-primary-50" %>
          
          <!-- お気に入りへのリンク（購買者のみ） -->
          <% if current_user.buyer? %>
            <%= link_to "お気に入り", favorites_path, 
                  class: "block px-3 py-2 rounded-md text-base font-medium text-estate-dark-600 hover:text-estate-success-600 hover:bg-estate-success-50" %>
          <% end %>
          
          <!-- オーナー向け：マイ物件 -->
          <% if current_user.owner? %>
            <%= link_to "物件管理", my_properties_path, 
                  class: "block px-3 py-2 rounded-md text-base font-medium text-estate-dark-600 hover:text-estate-primary-600 hover:bg-estate-primary-50" %>
          <% end %>
          
          <!-- 不動産業者向けメニュー -->
          <% if current_user.agent? %>
            <%= link_to "オーナー検索", properties_path, 
                  class: "block px-3 py-2 rounded-md text-base font-medium text-estate-dark-600 hover:text-estate-primary-600 hover:bg-estate-primary-50" %>
            <%= link_to "パートナー管理", partnerships_path, 
                  class: "block px-3 py-2 rounded-md text-base font-medium text-estate-dark-600 hover:text-estate-success-600 hover:bg-estate-success-50" %>
            <div class="flex items-center justify-between">
              <%= link_to conversations_path, 
                    class: "flex-1 px-3 py-2 rounded-md text-base font-medium text-estate-dark-600 hover:text-estate-primary-600 hover:bg-estate-primary-50 flex items-center" do %>
                メッセージ
                <% if current_user.unread_messages_count > 0 %>
                  <span class="ml-2 bg-red-500 text-white text-xs rounded-full px-2 py-0.5">
                    <%= current_user.unread_messages_count %>
                  </span>
                <% end %>
              <% end %>
            </div>
          <% end %>
          
          <div class="pt-4 border-t border-estate-warm-200 mt-4">
            <div class="px-3 py-2">
              <p class="text-sm text-estate-dark-500 mb-3">こんにちは、<%= current_user.name %>さん</p>
              <%= button_to "ログアウト", destroy_user_session_path, 
                            method: :delete,
                            form: { "data-turbo-confirm": "ログアウトしますか？" },
                            class: "w-full bg-estate-primary-600 hover:bg-estate-primary-700 text-white font-medium px-4 py-2 rounded-md transition-colors duration-200" %>
            </div>
          </div>
        <% else %>
          <!-- ログインしていない場合 -->
          <%= link_to "物件を探す", properties_path, 
                class: "block px-3 py-2 rounded-md text-base font-medium text-estate-dark-600 hover:text-estate-primary-600 hover:bg-estate-primary-50" %>
          <%= link_to "ログイン", new_user_session_path, 
                class: "block px-3 py-2 rounded-md text-base font-medium bg-estate-primary-600 text-white hover:bg-estate-primary-700" %>
          <%= link_to "会員登録", new_user_registration_path, 
                class: "block px-3 py-2 rounded-md text-base font-medium border border-estate-primary-600 text-estate-primary-600 hover:bg-estate-primary-600 hover:text-white" %>
        <% end %>
      </div>
    </div>
  </div>
</nav>